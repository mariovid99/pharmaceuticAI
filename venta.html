<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pharma Market Intelligence</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.0.4/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.2.0"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --carbon: #121212;
        --cloud-blue: #66ccff;
        --neon-green: #32ff6a;
        --mist-gray: #c7ccd1;
        --pure-white: #ffffff;
        --dark-gray: #1e1e1e;
        --medium-gray: #2d2d2d;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: var(--carbon);
        color: var(--pure-white);
        min-height: 100vh;
        padding: 20px;
      }

      .dashboard-container {
        max-width: 1800px;
        margin: 0 auto;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 0;
        border-bottom: 1px solid var(--medium-gray);
        margin-bottom: 30px;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .logo-icon {
        background: linear-gradient(
          135deg,
          var(--cloud-blue),
          var(--neon-green)
        );
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
      }

      .logo-text h1 {
        font-size: 28px;
        font-weight: 700;
        background: linear-gradient(
          90deg,
          var(--cloud-blue),
          var(--neon-green)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 5px;
      }

      .logo-text p {
        color: var(--mist-gray);
        font-size: 14px;
      }

      .date-display {
        background-color: var(--dark-gray);
        padding: 10px 20px;
        border-radius: 30px;
        font-size: 14px;
        border: 1px solid var(--medium-gray);
      }

      .filters {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }

      .filter-group {
        flex: 1;
        min-width: 250px;
      }

      .filter-group label {
        display: block;
        margin-bottom: 10px;
        color: var(--mist-gray);
        font-weight: 500;
      }

      .filter-group select,
      .filter-group input {
        width: 100%;
        padding: 12px 15px;
        background-color: var(--dark-gray);
        border: 1px solid var(--medium-gray);
        border-radius: 8px;
        color: var(--pure-white);
        font-size: 16px;
      }

      .filter-group select:focus,
      .filter-group input:focus {
        outline: none;
        border-color: var(--cloud-blue);
      }

      .cards-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .card {
        background-color: var(--dark-gray);
        border-radius: 12px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        border: 1px solid var(--medium-gray);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        border-color: var(--cloud-blue);
      }

      .card-title {
        color: var(--mist-gray);
        font-size: 16px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .card-value {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 10px;
        background: linear-gradient(
          90deg,
          var(--cloud-blue),
          var(--neon-green)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .card-change {
        font-size: 14px;
        color: var(--neon-green);
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .card-change.negative {
        color: #ff5e5e;
      }

      .charts-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin-bottom: 30px;
      }

      @media (max-width: 1200px) {
        .charts-grid {
          grid-template-columns: 1fr;
        }
      }

      .chart-container {
        background-color: var(--dark-gray);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid var(--medium-gray);
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .chart-title {
        font-size: 18px;
        font-weight: 600;
      }

      .chart-actions {
        display: flex;
        gap: 10px;
      }

      .chart-btn {
        background: none;
        border: 1px solid var(--medium-gray);
        color: var(--mist-gray);
        width: 32px;
        height: 32px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .chart-btn:hover {
        border-color: var(--cloud-blue);
        color: var(--pure-white);
        background-color: rgba(102, 204, 255, 0.1);
      }

      .chart-wrapper {
        height: 350px;
        position: relative;
      }

      .insights-container {
        background-color: var(--dark-gray);
        border-radius: 12px;
        padding: 25px;
        border: 1px solid var(--medium-gray);
        margin-bottom: 30px;
      }

      .insights-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
      }

      .insights-icon {
        background: linear-gradient(
          135deg,
          var(--cloud-blue),
          var(--neon-green)
        );
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
      }

      .insights-title {
        font-size: 20px;
        font-weight: 600;
      }

      .insights-content {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
      }

      .insight-card {
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        padding: 20px;
        border-left: 4px solid var(--neon-green);
      }

      .insight-card.warning {
        border-left-color: #ffa726;
      }

      .insight-card.alert {
        border-left-color: #ff5e5e;
      }

      .insight-card-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .insight-card-content {
        color: var(--mist-gray);
        line-height: 1.6;
      }

      .data-table-container {
        background-color: var(--dark-gray);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid var(--medium-gray);
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th {
        background-color: rgba(255, 255, 255, 0.05);
        color: var(--mist-gray);
        text-align: left;
        padding: 15px;
        font-weight: 500;
        border-bottom: 1px solid var(--medium-gray);
      }

      td {
        padding: 15px;
        border-bottom: 1px solid var(--medium-gray);
        color: var(--mist-gray);
      }

      tr:last-child td {
        border-bottom: none;
      }

      tr:hover td {
        background-color: rgba(255, 255, 255, 0.03);
        color: var(--pure-white);
      }

      .positive-change {
        color: var(--neon-green);
      }

      .negative-change {
        color: #ff5e5e;
      }

      .footer {
        text-align: center;
        padding: 30px 0;
        color: var(--mist-gray);
        font-size: 14px;
        border-top: 1px solid var(--medium-gray);
        margin-top: 20px;
      }

      .lab-tag {
        display: inline-block;
        padding: 3px 8px;
        background-color: rgba(102, 204, 255, 0.15);
        border-radius: 4px;
        color: var(--cloud-blue);
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <div class="dashboard-container">
      <header>
        <div class="logo">
          <div class="logo-icon">
            <i class="fas fa-pills"></i>
          </div>
          <div class="logo-text">
            <h1>Pharma Market Intelligence</h1>
            <p>Dashboard de Inteligencia Comercial Farmacéutica</p>
          </div>
        </div>
        <div class="date-display">
          <i class="fas fa-calendar-alt"></i> 11-15 Mayo 2025
        </div>
      </header>

      <div class="filters">
        <div class="filter-group">
          <label for="laboratory-filter"
            ><i class="fas fa-vial"></i> Filtrar por Laboratorio</label
          >
          <select id="laboratory-filter">
            <option value="all">Todos los Laboratorios</option>
            <!-- Options will be populated by JavaScript -->
          </select>
        </div>
        <div class="filter-group">
          <label for="date-range"
            ><i class="fas fa-calendar"></i> Rango de Fechas</label
          >
          <select id="date-range">
            <option value="all">Todo el Período</option>
            <option value="2025-05-11">11 Mayo 2025</option>
            <option value="2025-05-12">12 Mayo 2025</option>
            <option value="2025-05-13">13 Mayo 2025</option>
            <option value="2025-05-14">14 Mayo 2025</option>
            <option value="2025-05-15">15 Mayo 2025</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="product-search"
            ><i class="fas fa-search"></i> Buscar Producto</label
          >
          <input
            type="text"
            id="product-search"
            placeholder="Ingrese nombre de producto..."
          />
        </div>
      </div>

      <div class="cards-container">
        <div class="card">
          <div class="card-title">
            <i class="fas fa-chart-line"></i> Ventas Totales
          </div>
          <div class="card-value" id="total-sales">$185.2M</div>
          <div class="card-change">
            <i class="fas fa-arrow-up"></i> 12.4% vs período anterior
          </div>
        </div>
        <div class="card">
          <div class="card-title">
            <i class="fas fa-industry"></i> Laboratorios Activos
          </div>
          <div class="card-value" id="active-labs">28</div>
          <div class="card-change">
            <i class="fas fa-plus"></i> 3 nuevos este mes
          </div>
        </div>
        <div class="card">
          <div class="card-title">
            <i class="fas fa-pills"></i> Productos Monitoreados
          </div>
          <div class="card-value" id="products-tracked">62</div>
          <div class="card-change">
            <i class="fas fa-arrow-down"></i> 2 discontinuados
          </div>
        </div>
        <div class="card">
          <div class="card-title">
            <i class="fas fa-bolt"></i> Crecimiento Diario
          </div>
          <div class="card-value" id="daily-growth">4.8%</div>
          <div class="card-change negative">
            <i class="fas fa-arrow-down"></i> 1.2% vs ayer
          </div>
        </div>
      </div>

      <div class="charts-grid">
        <div class="chart-container">
          <div class="chart-header">
            <div class="chart-title">Ventas por Laboratorio (Top 10)</div>
            <div class="chart-actions">
              <button class="chart-btn"><i class="fas fa-download"></i></button>
              <button class="chart-btn"><i class="fas fa-expand"></i></button>
            </div>
          </div>
          <div class="chart-wrapper">
            <canvas id="lab-sales-chart"></canvas>
          </div>
        </div>
        <div class="chart-container">
          <div class="chart-header">
            <div class="chart-title">Tendencia de Ventas Diarias</div>
            <div class="chart-actions">
              <button class="chart-btn"><i class="fas fa-download"></i></button>
              <button class="chart-btn"><i class="fas fa-expand"></i></button>
            </div>
          </div>
          <div class="chart-wrapper">
            <canvas id="daily-trend-chart"></canvas>
          </div>
        </div>
        <div class="chart-container">
          <div class="chart-header">
            <div class="chart-title">Top Productos por Ventas</div>
            <div class="chart-actions">
              <button class="chart-btn"><i class="fas fa-download"></i></button>
              <button class="chart-btn"><i class="fas fa-expand"></i></button>
            </div>
          </div>
          <div class="chart-wrapper">
            <canvas id="top-products-chart"></canvas>
          </div>
        </div>
        <div class="chart-container">
          <div class="chart-header">
            <div class="chart-title">Correlación de Mercado</div>
            <div class="chart-actions">
              <button class="chart-btn"><i class="fas fa-download"></i></button>
              <button class="fas fa-expand chart-btn"></button>
            </div>
          </div>
          <div class="chart-wrapper">
            <canvas id="correlation-chart"></canvas>
          </div>
        </div>
      </div>

      <div class="insights-container">
        <div class="insights-header">
          <div class="insights-icon">
            <i class="fas fa-lightbulb"></i>
          </div>
          <div class="insights-title">Insights Estratégicos</div>
        </div>
        <div class="insights-content">
          <div class="insight-card">
            <div class="insight-card-title">
              <i class="fas fa-crown"></i> Líder de Mercado
            </div>
            <div class="insight-card-content">
              <strong>Tempra (Reckitt Benckiser)</strong> mantiene el liderazgo
              con una participación del 22.4% del mercado. Recomendamos reforzar
              alianzas estratégicas con este laboratorio.
            </div>
          </div>
          <div class="insight-card warning">
            <div class="insight-card-title">
              <i class="fas fa-chart-line"></i> Crecimiento Emergente
            </div>
            <div class="insight-card-content">
              <strong>Paracetamol Gi Qyf (Quimica Y Farmacia)</strong> muestra
              un crecimiento del 92% en los últimos 3 días. Considerar aumentar
              inventario y visibilidad en puntos de venta.
            </div>
          </div>
          <div class="insight-card">
            <div class="insight-card-title">
              <i class="fas fa-vial"></i> Oportunidad de Laboratorio
            </div>
            <div class="insight-card-content">
              <strong>Biomep</strong> tiene 3 productos con crecimiento superior
              al 40%. Sugerimos reunión estratégica para explorar expansión de
              portafolio.
            </div>
          </div>
          <div class="insight-card alert">
            <div class="insight-card-title">
              <i class="fas fa-exclamation-triangle"></i> Productos en Declive
            </div>
            <div class="insight-card-content">
              <strong>Xl-dol (Genomma)</strong> muestra una caída del 62% en
              ventas. Evaluar posible rotación de stock o promociones para
              evitar obsolescencia.
            </div>
          </div>
        </div>
      </div>

      <div class="data-table-container">
        <div class="chart-header">
          <div class="chart-title">Detalle de Ventas por Producto</div>
          <div class="chart-actions">
            <button class="chart-btn"><i class="fas fa-download"></i></button>
          </div>
        </div>
        <table id="products-table">
          <thead>
            <tr>
              <th>Marca</th>
              <th>Laboratorio</th>
              <th>11 May</th>
              <th>12 May</th>
              <th>13 May</th>
              <th>14 May</th>
              <th>15 May</th>
              <th>Tendencia</th>
            </tr>
          </thead>
          <tbody>
            <!-- Table rows will be populated by JavaScript -->
          </tbody>
        </table>
      </div>

      <div class="footer">
        <p>
          Pharma Market Intelligence Dashboard v1.0 • Datos actualizados al 15
          de Mayo 2025
        </p>
        <p>
          Análisis estratégico para toma de decisiones comerciales en el sector
          farmacéutico
        </p>
      </div>
    </div>

    <script>
      // Embedded data from Excel
      const rawData = [
        [
          "Marca",
          "Laboratorio",
          "2025-05-11 00:00:00",
          "2025-05-12 00:00:00",
          "2025-05-13 00:00:00",
          "2025-05-14 00:00:00",
          "2025-05-15 00:00:00",
        ],
        [
          "Tempra",
          "Reckitt Benckiser",
          11604063.65799,
          9137300.19556,
          9664745.92412,
          9577328.30766,
          8410725.10355,
        ],
        [
          "Paracetamol Gi Qyf - qyf",
          "Quimica Y Farmacia",
          2258405.20053,
          2461236.71369,
          3234253.46625,
          3774638.7006,
          4336728.20608,
        ],
        [
          "Tylenol",
          "Johnson Johnson",
          3560077.91185,
          3085835.46982,
          3134426.59354,
          3156442.39381,
          2738517.41185,
        ],
        [
          "Mejoral-pa",
          "Glaxosmithkline Po",
          732992.78843,
          669033.88916,
          541976.1177,
          600834.85926,
          444685.75327,
        ],
        [
          "Tempra Iv",
          "Bristol Myer Squib",
          20991.89154,
          55816.30774,
          101490.54347,
          215593.28928,
          272413.96059,
        ],
        [
          "Paracetamol Gi Bio - b8p",
          "Biomep",
          973.39615,
          42495.21181,
          12063.42046,
          124825.52352,
          253464.02156,
        ],
        [
          "Xl-dol",
          "Genomma",
          908270.57711,
          712548.76767,
          435682.45222,
          240267.15053,
          171292.85766,
        ],
        [
          "Paracetamol Gi Ken - md7",
          "Medley",
          73209.83227,
          309997.13382,
          386015.48213,
          163704.60978,
          138845.32626,
        ],
        [
          "Vicdol",
          "Victory Enterprise",
          33979.36259,
          28119.53156,
          39898.55853,
          167095.06473,
          89983.55639,
        ],
        [
          "Ac-fast",
          "Hormona",
          588.34141,
          1208.1316,
          26407.33149,
          49858.35425,
          76502.38121,
        ],
        [
          "Acetafen",
          "Rayere",
          25335.47275,
          22911.3481,
          29380.65123,
          34987.32602,
          71591.29787,
        ],
        [
          "Icetazol",
          "I.q.f.a.",
          419.11884,
          2288.22649,
          4.93157,
          243564.77395,
          61337.0389,
        ],
        [
          "Paracetamol Gi Lan - l7r",
          "Landsteiner Scient",
          9299.02367,
          16508.86071,
          15707.19636,
          6704.99883,
          44401.59944,
        ],
        [
          "Paracetamol Gi Car - ca3",
          "Carbel",
          1390.56015,
          4282.94811,
          21888.51808,
          53009.00611,
          41344.69147,
        ],
        [
          "Paracetamol Gi Alp - a_l",
          "Alpharma",
          9770.34042,
          12882.27998,
          25354.83663,
          38749.95669,
          38059.5185,
        ],
        [
          "Paracetamol Gi Win - md7",
          "Medley",
          43214.92538,
          31532.27261,
          41357.75778,
          83587.89128,
          31749.58958,
        ],
        [
          "Acetif",
          "Novag",
          120.60816,
          10207.77579,
          20629.76153,
          55599.3144,
          21194.37858,
        ],
        [
          "Paracetamo.gi Iqfa - iqf",
          "I.q.f.a.",
          20.87325,
          11433.47118,
          61768.83859,
          124695.89642,
          21006.54156,
        ],
        [
          "Quitadol",
          "Biomep",
          1946.88863,
          2421.1149,
          41331.33217,
          40420.10887,
          20659.45661,
        ],
        [
          "Paracetamol Gi Nvg - nvg",
          "Novag",
          0,
          0,
          0,
          17312.13413,
          17934.57625,
        ],
        [
          "Paracetamol Hormon - hor",
          "Hormona",
          23700.65191,
          26873.97987,
          40064.44835,
          7673.366,
          9458.9514,
        ],
        [
          "Portem",
          "Bruluart",
          0,
          16828.09173,
          607.11103,
          4777.44328,
          5035.16374,
        ],
        ["Pharmacen", "Alpharma", 0, 0, 0, 0, 4190.74437],
        ["Paracetamol Gi Ult - u3a", "Ultra", 0, 0, 0, 4.5426, 3166.86041],
        [
          "Minofen",
          "Liomont",
          3592.124,
          1798.55085,
          1451.83698,
          1048.03329,
          1396.73341,
        ],
        [
          "Coriver",
          "Maver",
          734.83022,
          59.65225,
          252.05438,
          489.05132,
          1063.68569,
        ],
        [
          "Son S Piral",
          "Quimica Son S",
          2953.42285,
          6591.57529,
          2925.0217,
          1162.7506,
          615.72287,
        ],
        [
          "Temperal",
          "Allen",
          409.9746,
          2369.42249,
          874.66643,
          25.02321,
          550.73252,
        ],
        ["Ulpafie", "Ultra", 0, 0, 0, 125.66448, 464.05541],
        [
          "Antidol",
          "Quimica Y Farmacia",
          99.13176,
          326.96283,
          1725.79858,
          9076.53677,
          165.30559,
        ],
        [
          "Andox Otc",
          "Atlantis",
          705.65163,
          265.21718,
          77.21011,
          76.18291,
          107.10146,
        ],
        [
          "Paracetamol Gi Fa. - f1d",
          "Farmadem",
          0,
          12702.78739,
          1803.59095,
          21.58049,
          7.31546,
        ],
        [
          "Paracetamol Gi Med - mnl",
          "Medic Nal",
          229828.09301,
          195099.75737,
          140045.64081,
          189.46931,
          5.9184,
        ],
        [
          "Paracetamol Gi Bru - buu",
          "Bruluart",
          2.91023,
          9440.3367,
          576.66609,
          16.71774,
          2.18151,
        ],
        ["Paracetamol Gi Sol - s9l", "Solara", 0, 0, 0, 0, 0.5698],
        ["Datril", "Bristol Myer Squib", 4691.14747, 0, 0, 0, 0],
        [
          "Magnidol Plus",
          "Streger",
          845.45289,
          334.75522,
          295.26088,
          86.76858,
          0,
        ],
        [
          "Mejoral Actirapido",
          "Glaxosmithkline Po",
          135054.70986,
          104010.97006,
          37219.50092,
          42.24011,
          0,
        ],
        ["Dolviran Nf", "Bayer Pharma", 3734.29251, 0, 0, 0, 0],
        ["Winasorb", "Winthrop", 88327.72554, 57336.48218, 352.89802, 0, 0],
        ["Abatem", "Wermar", 9045.77319, 0, 0, 0, 0],
        [
          "Paracetamol Gi Atl - atl",
          "Atlantis",
          0,
          513.59617,
          10.25449,
          10.23208,
          0,
        ],
        ["Paracetamol Gi Lif - lf3", "Liferpal Md", 0, 0, 0, 15.72299, 0],
        ["Paracetamol Gi Ran - ran", "Randall", 0, 3288.29833, 671.90732, 0, 0],
        ["Paracetamol Gi Ser - se0", "Serral", 10842.20815, 3095.5682, 0, 0, 0],
        ["Soltadol", "Aspen", 101.40034, 4.52762, 0, 0, 0],
        ["Panofen", "Liferpal Md", 931.29676, 202.85919, 0, 0, 0],
        [
          "Paracetamol Gi 3h - 3hp",
          "3h Pharmaceutics",
          0,
          0,
          3106.15969,
          4339.15732,
          0,
        ],
        [
          "Tempra",
          "Reckitt Benckiser",
          15153812.37143,
          13151493.68741,
          13112494.12834,
          13182724.24178,
          12014638.25534,
        ],
        [
          "Paracetamol Gi Qyf - qyf",
          "Quimica Y Farmacia",
          305358.22843,
          355386.61698,
          580637.85546,
          748970.92791,
          1119776.02297,
        ],
        [
          "Tylenol",
          "Johnson Johnson",
          816980.14675,
          614330.65237,
          623626.87888,
          656693.52366,
          603331.93649,
        ],
        [
          "Sedalmerk Sedalito",
          "Merck",
          173138.87814,
          111220.95718,
          105818.36006,
          217592.41106,
          194562.66826,
        ],
        ["Febraxito", "Siegfried Rhein", 0, 0, 0, 28343.8669, 182068.40483],
        [
          "Mejoralito",
          "Glaxosmithkline Po",
          278960.44217,
          200855.00693,
          160579.05113,
          191050.69802,
          145722.1513,
        ],
        [
          "Tempire",
          "Collins",
          26714.64599,
          28794.81037,
          31932.45949,
          20459.81202,
          39174.70163,
        ],
        ["Analphen", "Randall", 0, 0, 0, 15788.17504, 19011.09403],
        [
          "Paracetamol Gi Mav - mav",
          "Maver",
          0,
          0,
          11057.66728,
          11310.48887,
          3416.73134,
        ],
        [
          "Paracetamol Gi Int - ilb",
          "Interlab",
          0,
          0,
          0,
          9380.40361,
          3231.01972,
        ],
        [
          "Paracetamol Gi Alp - a_l",
          "Alpharma",
          0,
          123.46309,
          43.19441,
          4.43126,
          3206.52293,
        ],
        ["Pharmacen", "Alpharma", 0, 0, 0, 3820.65324, 2763.48088],
        [
          "Paracetamol Gi Ult - u3a",
          "Ultra",
          2458.95012,
          1568.98932,
          3054.58484,
          2709.19239,
          2619.89814,
        ],
        [
          "Prosedal",
          "Loeffler",
          12772.9021,
          10398.34881,
          8342.96058,
          9667.35337,
          2383.15751,
        ],
        ["Paracetamol Gi Eur - eux", "Euromex", 0, 0, 0, 47.50457, 1779.31146],
        [
          "Paracetamol Gi Bio - b8p",
          "Biomep",
          0,
          394.27379,
          9740.76881,
          13423.67464,
          1763.34913,
        ],
        [
          "Minofen",
          "Liomont",
          5224.86011,
          3672.02746,
          2836.14768,
          1720.3603,
          1450.9606,
        ],
        [
          "Piremol",
          "Loeffler",
          0.48673,
          0.99602,
          15.53106,
          364.55745,
          1133.36546,
        ],
        [
          "Adinol",
          "Bruluart",
          69.53016,
          22.94563,
          102.2964,
          9066.90217,
          993.03672,
        ],
        [
          "Coriver",
          "Maver",
          8683.4853,
          6853.80105,
          2668.18144,
          4046.34516,
          961.71141,
        ],
        ["Paracetamol Gi Loe - lol", "Loeffler", 0, 0, 0, 0.33115, 518.19054],
        ["Wamindel", "Biomep", 0, 7738.04613, 2163.49573, 13.69051, 210.57353],
        [
          "Son S Piral",
          "Quimica Son S",
          6358.10753,
          3701.43805,
          84.71689,
          134.60264,
          95.16903,
        ],
        [
          "Paracetamol Gi Lio - pgn",
          "Pharmagen",
          10033.55333,
          3322.25341,
          1461.22432,
          359.52712,
          39.40436,
        ],
        [
          "Paracetamol Gi Val - val",
          "Valdecasas",
          0,
          155.61333,
          949.38245,
          275.12448,
          31.51645,
        ],
        ["Suprim", "Degort S", 0, 0.22665, 0.06732, 0.00765, 28.14717],
        [
          "Paracetamol Gi Arl - adm",
          "Arlex",
          6655.80152,
          58083.35886,
          19547.08688,
          5323.85837,
          24.18721,
        ],
        [
          "Antido-lito",
          "Quimica Y Farmacia",
          677.65744,
          1219.29348,
          6510.3932,
          21980.49564,
          23.53946,
        ],
        [
          "Paracetamol Gi Far - f_c",
          "Farmacos Continent",
          0,
          0,
          0,
          27.71263,
          3.85066,
        ],
        [
          "Paracetamol Gi Med - mnl",
          "Medic Nal",
          111637.55363,
          54439.95419,
          31693.73405,
          57.09606,
          0,
        ],
        ["Carofril", "Arlex", 0, 129.64098, 0, 0, 0],
        [
          "Paracetamol Gi 3h - 3hp",
          "3h Pharmaceutics",
          0,
          0,
          2436.28984,
          3895.65758,
          0,
        ],
        ["Paracetamol Gi Col - col", "Collins", 0, 48.35235, 6451.60142, 0, 0],
        ["Paracetamol Gi Wan - wnl", "Wandel", 0, 0, 0, 80.731, 0],
        ["Paracetamol Gi Bru - buu", "Bruluart", 0, 0, 0, 1.42371, 0],
        [
          "Paracetamol Merck - mck",
          "Merck",
          26909.76594,
          8673.0443,
          81.82652,
          77.58563,
          0,
        ],
        ["Febrim", "Rimsa", 0, 0, 4.8323, 50.35418, 0],
        [
          "Tempra Forte",
          "Reckitt Benckiser",
          8636928.80751,
          7299736.91042,
          8064186.1592,
          8375951.00973,
          7366184.28485,
        ],
        [
          "Paracetamol Gi Qyf - qyf",
          "Quimica Y Farmacia",
          1609393.71479,
          1990489.7774,
          1102224.33768,
          3119967.52721,
          4238918.73831,
        ],
        ["Paracetamol Gi And - ifa", "Ind.far.andromaco", 0.62402, 0, 0, 0, 0],
        ["Antidol", "Quimica Y Farmacia", 390.13216, 0, 0, 0, 0],
        ["Paracetamol Gi Dib - dba", "Diba", 0, 0, 0, 41.25843, 0],
        [
          "Tempra Iv",
          "Bristol Myer Squib",
          2447905.26891,
          3209071.85442,
          5273940.78129,
          7392371.42475,
          8121501.58015,
        ],
        [
          "Tafirol",
          "Asofarma",
          2483740.78037,
          2472786.94909,
          2727747.02614,
          2931236.13637,
          2741626.92265,
        ],
        [
          "Tylex",
          "Janssen",
          9982673.80549,
          9017731.07483,
          9550380.0281,
          9889988.53017,
          8850503.36429,
        ],
        ["Paracetamol Gi Lem - l0m", "Leman", 0, 0, 0, 0, 1150400.50314],
        [
          "Paracetamol Gi Btk - bk_",
          "Btk Farma",
          0,
          22092.92574,
          75158.89248,
          88401.69975,
          126713.47864,
        ],
        [
          "Acetafen",
          "Rayere",
          45642.76381,
          54400.42715,
          85466.93026,
          111598.59863,
          102133.46882,
        ],
        [
          "Paracetamol Gi Bio - b8p",
          "Biomep",
          0,
          1584.34414,
          12622.76045,
          19873.29726,
          18200.80022,
        ],
        [
          "Quitadol",
          "Biomep",
          2641.86309,
          39737.84843,
          22676.13231,
          12875.89465,
          16491.363,
        ],
        ["Portem", "Bruluart", 0, 0, 6198.84085, 1872.92807, 5981.19295],
        [
          "Paracetamol Gi Ran - ran",
          "Randall",
          0,
          3077.55118,
          2120.87492,
          145.86333,
          3695.899,
        ],
        [
          "Paracetamol Gi Ino - ixa",
          "Inovaxa",
          0,
          0,
          0,
          1236.08638,
          3524.90488,
        ],
        [
          "Paracetamol Gi Ser - se0",
          "Serral",
          4842.28627,
          2726.63422,
          0,
          0,
          9.1942,
        ],
        ["Paracetamol Gi Ult - u3a", "Ultra", 0, 0, 0, 0.00076, 9.04971],
        [
          "Paracetamol Gi Med - mnl",
          "Medic Nal",
          102438.11885,
          85152.92869,
          95793.29074,
          4229.44847,
          1.18384,
        ],
        ["Facetol", "Nafar", 11245.15894, 7373.81687, 533.02047, 10.5768, 0],
        ["Paracetamol Gi Ray - ray", "Rayere", 0, 0, 130.2742, 90.4555, 0],
        [
          "Paracetamol Gi Bru - buu",
          "Bruluart",
          13.04175,
          4040.87611,
          0.63064,
          1.4804,
          0,
        ],
        [
          "Tempra",
          "Reckitt Benckiser",
          10799430.77833,
          8566317.28926,
          9635853.00297,
          9791509.63659,
          8651107.76238,
        ],
        [
          "Dolviran",
          "Bayer Pharma",
          98230.45909,
          67099.82837,
          18772.02652,
          4.62938,
          0,
        ],
        ["Febrim", "Rimsa", 0, 0, 21.6389, 246.68839, 0],
        [
          "Tempra",
          "Reckitt Benckiser",
          1515916.89302,
          1408413.01567,
          1608061.26083,
          1638664.80614,
          1474960.02864,
        ],
        [
          "Tylenol",
          "Johnson Johnson",
          1202421.10393,
          911850.93041,
          1048392.4664,
          1050776.28115,
          1135361.59548,
        ],
        [
          "Paracetamol Gi Qyf - qyf",
          "Quimica Y Farmacia",
          154714.50028,
          161392.35112,
          241954.24475,
          259838.78667,
          211029.49016,
        ],
        [
          "Paracetamol Gi Ult - u3a",
          "Ultra",
          611.1858,
          20275.57017,
          98078.29901,
          189744.90824,
          201542.85703,
        ],
        ["Icetazol", "I.q.f.a.", 0, 0, 3831.21941, 48838.44296, 64059.39587],
        ["Paracetamol Gi Lem - l0m", "Leman", 0, 0, 0, 0, 24231.44679],
        [
          "Son S Piral",
          "Quimica Son S",
          9272.18818,
          4778.80892,
          4133.04295,
          7551.55342,
          13494.83916,
        ],
        [
          "Paracetamol Gi Int - ilb",
          "Interlab",
          0,
          0,
          821.55607,
          17722.46253,
          8557.1553,
        ],
        [
          "Paracetamo.gi Iqfa - iqf",
          "I.q.f.a.",
          3570.7099,
          5123.17324,
          5599.44011,
          11718.40544,
          5041.28884,
        ],
        [
          "Mejoralito",
          "Glaxosmithkline Po",
          174503.00793,
          138180.0142,
          119788.27428,
          87724.24021,
          3967.48678,
        ],
        [
          "Paracetamol Gi Loe - lol",
          "Loeffler",
          0,
          0,
          1.31035,
          0.98407,
          3341.21831,
        ],
        [
          "Ulpafie",
          "Ultra",
          95.73235,
          238.66216,
          345.1349,
          392.42109,
          1269.7665,
        ],
        [
          "Adinol",
          "Bruluart",
          9.36816,
          56.25492,
          76.44232,
          141.6614,
          856.66522,
        ],
        ["Piralgina-pa", "Diba", 0, 0, 1668.63154, 3576.57566, 209.66174],
        [
          "Paracetamol Gi Vlt - vlt",
          "Valeant",
          0,
          0,
          3559.19683,
          15991.99154,
          104.84762,
        ],
        ["36.5", "Genomma", 2434.15679, 63489.55082, 65172.46926, 0, 7.74453],
        ["Paracetamol Gi Arl - adm", "Arlex", 0, 0, 0, 2.07644, 3.61822],
        [
          "Paracetamol Gi Far - f_c",
          "Farmacos Continent",
          0,
          0,
          0,
          0.5891,
          0.09151,
        ],
        ["Paracetamol Gi Ran - ran", "Randall", 0, 7776.98156, 326.01193, 0, 0],
        [
          "Paracetamol Gi And - ifa",
          "Ind.far.andromaco",
          8699.22395,
          0,
          0,
          0,
          0,
        ],
        [
          "Paracetamol Gi Bio - b8p",
          "Biomep",
          0,
          712.92955,
          11688.75504,
          11885.79518,
          0,
        ],
        [
          "Paracetamol Gi Atl - atl",
          "Atlantis",
          0,
          8448.98349,
          5453.49282,
          3.01208,
          0,
        ],
        [
          "Paracetamol Gi 3h - 3hp",
          "3h Pharmaceutics",
          0,
          0,
          2753.84108,
          1599.23865,
          0,
        ],
        [
          "Paracetamol Gi Med - mnl",
          "Medic Nal",
          60714.55781,
          40939.44596,
          30990.26769,
          17.54623,
          0,
        ],
        ["Paracetamol Gi Ken - md7", "Medley", 0, 0, 0.88283, 0, 0],
        [
          "Mejoralito",
          "Glaxosmithkline Po",
          2159435.47819,
          2295208.69303,
          2270494.58356,
          1950827.7573,
          1517876.5828,
        ],
        [
          "Tempra",
          "Reckitt Benckiser",
          1061474.5876,
          745415.85199,
          779048.72527,
          673567.4071,
          993922.03162,
        ],
        [
          "Paracetamol Gi Qyf - qyf",
          "Quimica Y Farmacia",
          85811.84494,
          89820.65227,
          104870.32221,
          243014.32701,
          274375.6549,
        ],
        [
          "Sedalmerk Sedalito",
          "Merck",
          37942.46021,
          80760.0439,
          85964.13534,
          92283.29791,
          4286.22616,
        ],
        [
          "Xl-dol",
          "Genomma",
          128778.63646,
          121443.36011,
          62383.9052,
          4920.28886,
          1015.97623,
        ],
        [
          "Antido-lito",
          "Quimica Y Farmacia",
          203.58174,
          325.83856,
          404.69959,
          868.17869,
          73.61353,
        ],
        [
          "Tylenol",
          "Johnson Johnson",
          127941.49341,
          81486.82719,
          66088.38104,
          17390.80304,
          30.74634,
        ],
        ["Coriver", "Maver", 335.48096, 542.52559, 155.02343, 3.8631, 0],
        ["Paracetamol Gi Atl - atl", "Atlantis", 0, 170.7458, 115.71085, 0, 0],
        [
          "Vita Pyrena",
          "Procter Gamble",
          597284.25236,
          432977.0861,
          484335.98104,
          792380.23637,
          634757.13322,
        ],
        [
          "Ulpafie",
          "Ultra",
          54.8373,
          168.50717,
          391.0386,
          919.82219,
          455.31615,
        ],
        [
          "Temperal",
          "Allen",
          442.09088,
          2216.93297,
          813.99976,
          90.14305,
          73.05338,
        ],
        ["Temprin", "Farmacos Continent", 0, 0, 17.02711, 288.80592, 42.24096],
        ["Sidus", "Ind.far.andromaco", 0, 0, 0, 201.92064, 38.75986],
        ["Analphen", "Randall", 0, 77.67395, 35.10078, 0, 0],
        ["Tempra", "Reckitt Benckiser", 0, 0, 0, 0, 375214.26837],
        [
          "Paracetamol Gi Alp - a_l",
          "Alpharma",
          0,
          1609.73745,
          21084.26182,
          22785.95101,
          11944.1483,
        ],
        [
          "Piremol",
          "Loeffler",
          1151.55856,
          1019.16308,
          823.18908,
          1057.04818,
          1854.87827,
        ],
        [
          "Biofer",
          "Bioresearch",
          11.0214,
          1069.28892,
          1078.85834,
          2123.65206,
          1091.89397,
        ],
        [
          "Paracetamol Gi Loe - lol",
          "Loeffler",
          0,
          29.17266,
          0,
          659.58559,
          346.94415,
        ],
        ["Pharmacen", "Alpharma", 0, 0, 121.69914, 98.45867, 143.2419],
        [
          "Tempra",
          "Reckitt Benckiser",
          919161.8291,
          625248.51854,
          5625.5127,
          239.9016,
          4.86172,
        ],
        ["Sudis", "Ind.far.andromaco", 7.1089, 0, 0, 0, 0],
        ["Panofen", "Liferpal Md", 35.1965, 39.63209, 344.5492, 30.13193, 0],
        [
          "Paracetamol Gi Med - mnl",
          "Medic Nal",
          4660.63635,
          2249.87034,
          2536.56845,
          0,
          0,
        ],
        [
          "Paracetamol Gi Rag - rg6",
          "Ragar",
          0,
          702.63748,
          7026.38995,
          51.41556,
          0,
        ],
        [
          "Paracetamol Gi Lif - lf3",
          "Liferpal Md",
          0,
          213.24027,
          13.74345,
          0,
          0,
        ],
        [
          "Mejoralito",
          "Glaxosmithkline Po",
          158567.9565,
          98972.96019,
          82069.71162,
          81969.05158,
          5910.3189,
        ],
        ["Panofen", "Liferpal Md", 0, 0, 0, 117.61678, 33.0319],
        [
          "Minofen",
          "Liomont",
          5925.64651,
          4361.00988,
          2687.85287,
          1641.55529,
          1259.93517,
        ],
      ];

      // Data processing
      const headers = rawData[0];
      const rows = rawData.slice(1);

      // Extract unique laboratories
      const labs = [...new Set(rows.map((row) => row[1]))].sort();

      // Process data for charts
      const dates = headers.slice(2);

      // Calculate total sales per day
      const dailyTotals = dates.map((_, i) => {
        return rows.reduce((sum, row) => sum + row[i + 2], 0);
      });

      // Calculate sales by laboratory
      const labSales = {};
      labs.forEach((lab) => {
        labSales[lab] = rows
          .filter((row) => row[1] === lab)
          .reduce((sum, row) => {
            for (let i = 2; i < 7; i++) {
              sum += row[i];
            }
            return sum;
          }, 0);
      });

      // Sort labs by sales
      const sortedLabs = Object.entries(labSales)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10);

      // Get top products by sales on the last day
      const topProducts = [...rows].sort((a, b) => b[6] - a[6]).slice(0, 10);

      // Calculate correlation matrix for top 10 labs
      const correlationData = [];
      const topLabs = sortedLabs.map((lab) => lab[0]);

      for (let i = 0; i < topLabs.length; i++) {
        const lab1 = topLabs[i];
        const lab1Data = [];

        // Get daily sales for this lab
        for (let day = 0; day < 5; day++) {
          const sales = rows
            .filter((row) => row[1] === lab1)
            .reduce((sum, row) => sum + row[day + 2], 0);
          lab1Data.push(sales);
        }

        for (let j = 0; j < topLabs.length; j++) {
          const lab2 = topLabs[j];
          const lab2Data = [];

          // Get daily sales for the other lab
          for (let day = 0; day < 5; day++) {
            const sales = rows
              .filter((row) => row[1] === lab2)
              .reduce((sum, row) => sum + row[day + 2], 0);
            lab2Data.push(sales);
          }

          // Calculate Pearson correlation
          const correlation = calculateCorrelation(lab1Data, lab2Data);
          correlationData.push({
            x: lab1,
            y: lab2,
            v: correlation,
          });
        }
      }

      // Calculate trend for each product (last day vs first day)
      const productsWithTrend = rows.map((row) => {
        const firstDay = row[2];
        const lastDay = row[6];
        const trend = lastDay > 0 ? ((lastDay - firstDay) / firstDay) * 100 : 0;
        return [...row, trend];
      });

      // Initialize dashboard
      document.addEventListener("DOMContentLoaded", function () {
        // Populate laboratory filter
        const labFilter = document.getElementById("laboratory-filter");
        labs.forEach((lab) => {
          const option = document.createElement("option");
          option.value = lab;
          option.textContent = lab;
          labFilter.appendChild(option);
        });

        // Populate products table
        const tableBody = document.querySelector("#products-table tbody");
        productsWithTrend.forEach((row) => {
          const tr = document.createElement("tr");

          // Brand
          const brandTd = document.createElement("td");
          brandTd.textContent = row[0];
          tr.appendChild(brandTd);

          // Laboratory
          const labTd = document.createElement("td");
          labTd.innerHTML = `<span class="lab-tag">${row[1]}</span>`;
          tr.appendChild(labTd);

          // Daily sales
          for (let i = 2; i < 7; i++) {
            const salesTd = document.createElement("td");
            salesTd.textContent = formatCurrency(row[i]);
            tr.appendChild(salesTd);
          }

          // Trend
          const trendTd = document.createElement("td");
          const trend = row[7];
          trendTd.textContent =
            trend > 0 ? `+${trend.toFixed(1)}%` : `${trend.toFixed(1)}%`;
          trendTd.className = trend > 0 ? "positive-change" : "negative-change";
          tr.appendChild(trendTd);

          tableBody.appendChild(tr);
        });

        // Initialize charts
        initLabSalesChart();
        initDailyTrendChart();
        initTopProductsChart();
        initCorrelationChart();
      });

      // Chart initialization functions
      function initLabSalesChart() {
        const ctx = document.getElementById("lab-sales-chart").getContext("2d");
        new Chart(ctx, {
          type: "bar",
          data: {
            labels: sortedLabs.map((lab) => lab[0]),
            datasets: [
              {
                label: "Ventas Totales (Millones)",
                data: sortedLabs.map((lab) => lab[1] / 1000000),
                backgroundColor: "#66CCFF",
                borderColor: "#32FF6A",
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return `Ventas: $${formatCurrency(context.raw * 1000000)}`;
                  },
                },
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  color: "rgba(199, 204, 209, 0.1)",
                },
                ticks: {
                  color: "#C7CCD1",
                },
              },
              x: {
                grid: {
                  color: "rgba(199, 204, 209, 0.1)",
                },
                ticks: {
                  color: "#C7CCD1",
                },
              },
            },
          },
        });
      }

      function initDailyTrendChart() {
        const ctx = document
          .getElementById("daily-trend-chart")
          .getContext("2d");
        new Chart(ctx, {
          type: "line",
          data: {
            labels: dates.map((date) => date.split(" ")[0]),
            datasets: [
              {
                label: "Ventas Totales",
                data: dailyTotals.map((total) => total / 1000000),
                borderColor: "#32FF6A",
                backgroundColor: "rgba(50, 255, 106, 0.1)",
                borderWidth: 3,
                tension: 0.3,
                fill: true,
                pointBackgroundColor: "#66CCFF",
                pointBorderColor: "#121212",
                pointBorderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return `Ventas: $${formatCurrency(context.raw * 1000000)}`;
                  },
                },
              },
            },
            scales: {
              y: {
                grid: {
                  color: "rgba(199, 204, 209, 0.1)",
                },
                ticks: {
                  color: "#C7CCD1",
                },
              },
              x: {
                grid: {
                  color: "rgba(199, 204, 209, 0.1)",
                },
                ticks: {
                  color: "#C7CCD1",
                },
              },
            },
          },
        });
      }

      function initTopProductsChart() {
        const ctx = document
          .getElementById("top-products-chart")
          .getContext("2d");
        new Chart(ctx, {
          type: "bar",
          data: {
            labels: topProducts.map((product) => product[0]),
            datasets: [
              {
                label: "Ventas (Millones)",
                data: topProducts.map((product) => product[6] / 1000000),
                backgroundColor: topProducts.map((_, i) =>
                  i % 2 === 0 ? "#66CCFF" : "#32FF6A"
                ),
                borderColor: "#121212",
                borderWidth: 1,
              },
            ],
          },
          options: {
            indexAxis: "y",
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return `Ventas: $${formatCurrency(context.raw * 1000000)}`;
                  },
                },
              },
            },
            scales: {
              x: {
                beginAtZero: true,
                grid: {
                  color: "rgba(199, 204, 209, 0.1)",
                },
                ticks: {
                  color: "#C7CCD1",
                },
              },
              y: {
                grid: {
                  color: "rgba(199, 204, 209, 0.1)",
                },
                ticks: {
                  color: "#C7CCD1",
                },
              },
            },
          },
        });
      }

      // Función modificada para la matriz de correlación con gradientes
      function initCorrelationChart() {
        const ctx = document
          .getElementById("correlation-chart")
          .getContext("2d");

        // Configuración de colores para correlación
        const getCorrelationColor = (value) => {
          const positive = Math.max(0, value);
          const negative = Math.abs(Math.min(0, value));

          return `rgb(${Math.floor(255 * negative)}, ${Math.floor(
            255 * (1 - positive - negative)
          )}, ${Math.floor(255 * positive)})`;
        };

        new Chart(ctx, {
          type: "bubble",
          data: {
            datasets: [
              {
                label: "Correlación de Mercado",
                data: correlationData.map((item) => ({
                  ...item,
                  r: Math.abs(item.v) * 15 + 5, // Tamaño proporcional a la correlación
                })),
                backgroundColor: correlationData.map((item) =>
                  getCorrelationColor(item.v)
                ),
                borderColor: "#121212",
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return `${context.raw.x} vs ${
                      context.raw.y
                    }: ${context.raw.v.toFixed(2)}`;
                  },
                },
              },
            },
            scales: {
              x: {
                type: "category",
                labels: topLabs,
                grid: { color: "rgba(199, 204, 209, 0.1)" },
                ticks: { color: "#C7CCD1" },
              },
              y: {
                type: "category",
                labels: topLabs,
                grid: { color: "rgba(199, 204, 209, 0.1)" },
                ticks: { color: "#C7CCD1" },
              },
            },
          },
        });
      }
      // Helper functions
      function calculateCorrelation(x, y) {
        const n = x.length;
        let sumX = 0,
          sumY = 0,
          sumXY = 0,
          sumX2 = 0,
          sumY2 = 0;

        for (let i = 0; i < n; i++) {
          sumX += x[i];
          sumY += y[i];
          sumXY += x[i] * y[i];
          sumX2 += x[i] * x[i];
          sumY2 += y[i] * y[i];
        }

        const numerator = n * sumXY - sumX * sumY;
        const denominator = Math.sqrt(
          (n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY)
        );

        return denominator !== 0 ? numerator / denominator : 0;
      }

      function formatCurrency(value) {
        if (value >= 1000000) {
          return `$${(value / 1000000).toFixed(2)}M`;
        } else if (value >= 1000) {
          return `$${(value / 1000).toFixed(1)}K`;
        }
        return `$${value.toFixed(0)}`;
      }
    </script>
  </body>
</html>
